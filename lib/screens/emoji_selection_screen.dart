import 'package:flutter/material.dart';

class EmojiSelectionScreen extends StatefulWidget {
  final String? currentEmoji;
  final Function(String) onEmojiSelected;

  const EmojiSelectionScreen({
    Key? key,
    this.currentEmoji,
    required this.onEmojiSelected,
  }) : super(key: key);

  @override
  State<EmojiSelectionScreen> createState() => _EmojiSelectionScreenState();
}

class _EmojiSelectionScreenState extends State<EmojiSelectionScreen> {
  final TextEditingController _searchController = TextEditingController();
  final Map<String, List<String>> _emojiCategories = {};
  final Map<String, String> _emojiKeywords = {};
  List<String> _filteredEmojis = [];
  List<String> _categoryTabs = [];
  String _selectedCategory = 'All';
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    _searchController.addListener(_filterEmojis);
    _loadEmojis();
  }

  @override
  void dispose() {
    _searchController.dispose();
    super.dispose();
  }

  void _loadEmojis() {
    // Load emojis in background to avoid UI freeze
    Future.microtask(() {
      _initializeEmojiData();
      if (mounted) {
        setState(() {
          _isLoading = false;
          _filteredEmojis = _getAllEmojis();
        });
      }
    });
  }

  void _initializeEmojiData() {
    // Define emojis by categories
    _emojiCategories['Smileys & People'] = [
      'ğŸ˜€',
      'ğŸ˜ƒ',
      'ğŸ˜„',
      'ğŸ˜',
      'ğŸ˜†',
      'ğŸ˜…',
      'ğŸ˜‚',
      'ğŸ¤£',
      'ğŸ˜Š',
      'ğŸ˜‡',
      'ğŸ™‚',
      'ğŸ™ƒ',
      'ğŸ˜‰',
      'ğŸ˜Œ',
      'ğŸ˜',
      'ğŸ¥°',
      'ğŸ˜˜',
      'ğŸ˜—',
      'ğŸ˜™',
      'ğŸ˜š',
      'ğŸ˜‹',
      'ğŸ˜›',
      'ğŸ˜',
      'ğŸ˜œ',
      'ğŸ¤ª',
      'ğŸ¤¨',
      'ğŸ§',
      'ğŸ¤“',
      'ğŸ˜',
      'ğŸ¤©',
      'ğŸ¥³',
      'ğŸ˜',
      'ğŸ˜’',
      'ğŸ˜',
      'ğŸ˜”',
      'ğŸ˜Ÿ',
      'ğŸ˜•',
      'ğŸ™',
      'â˜¹ï¸',
      'ğŸ˜£',
      'ğŸ˜–',
      'ğŸ˜«',
      'ğŸ˜©',
      'ğŸ¥º',
      'ğŸ˜¢',
      'ğŸ˜­',
      'ğŸ˜¤',
      'ğŸ˜ ',
      'ğŸ˜¡',
      'ğŸ¤¬',
      'ğŸ¤¯',
      'ğŸ˜³',
      'ğŸ¥µ',
      'ğŸ¥¶',
      'ğŸ˜±',
      'ğŸ˜¨',
      'ğŸ˜°',
      'ğŸ˜¥',
      'ğŸ˜“',
      'ğŸ¤—',
      'ğŸ¤”',
      'ğŸ¤­',
      'ğŸ¤«',
      'ğŸ¤¥',
      'ğŸ˜¶',
      'ğŸ˜',
      'ğŸ˜‘',
      'ğŸ˜¬',
      'ğŸ™„',
      'ğŸ˜¯',
      'ğŸ˜¦',
      'ğŸ˜§',
      'ğŸ˜®',
      'ğŸ˜²',
      'ğŸ¥±',
      'ğŸ˜´',
      'ğŸ¤¤',
      'ğŸ˜ª',
      'ğŸ˜µ',
      'ğŸ¤',
      'ğŸ¥´',
      'ğŸ¤¢',
      'ğŸ¤®',
      'ğŸ¤§',
      'ğŸ˜·',
      'ğŸ¤’',
      'ğŸ¤•',
      'ğŸ¤‘',
      'ğŸ¤ ',
      'ğŸ˜ˆ',
      'ğŸ‘¿',
      'ğŸ‘¹',
      'ğŸ‘º',
      'ğŸ¤¡',
      'ğŸ’©',
      'ğŸ‘»',
      'ğŸ’€',
      'â˜ ï¸',
      'ğŸ‘½',
      'ğŸ‘¾',
      'ğŸ¤–',
      'ğŸƒ',
      'ğŸ˜º',
      'ğŸ˜¸',
      'ğŸ˜¹',
      'ğŸ˜»',
      'ğŸ˜¼',
      'ğŸ˜½',
      'ğŸ™€',
      'ğŸ˜¿',
      'ğŸ˜¾'
    ];

    _emojiCategories['Hands & Body'] = [
      'ğŸ‘‹',
      'ğŸ¤š',
      'ğŸ–ï¸',
      'âœ‹',
      'ğŸ––',
      'ğŸ‘Œ',
      'ğŸ¤Œ',
      'ğŸ¤',
      'âœŒï¸',
      'ğŸ¤',
      'ğŸ¤Ÿ',
      'ğŸ¤˜',
      'ğŸ¤™',
      'ğŸ‘ˆ',
      'ğŸ‘‰',
      'ğŸ‘†',
      'ğŸ–•',
      'ğŸ‘‡',
      'â˜ï¸',
      'ğŸ‘',
      'ğŸ‘',
      'âœŠ',
      'ğŸ‘Š',
      'ğŸ¤›',
      'ğŸ¤œ',
      'ğŸ‘',
      'ğŸ™Œ',
      'ğŸ‘',
      'ğŸ¤²',
      'ğŸ¤',
      'ğŸ™',
      'âœï¸',
      'ğŸ’…',
      'ğŸ¤³',
      'ğŸ’ª',
      'ğŸ¦¾',
      'ğŸ¦¿',
      'ğŸ¦µ',
      'ğŸ¦¶',
      'ğŸ‘‚',
      'ğŸ¦»',
      'ğŸ‘ƒ',
      'ğŸ§ ',
      'ğŸ¦·',
      'ğŸ¦´',
      'ğŸ‘€',
      'ğŸ‘ï¸',
      'ğŸ‘…',
      'ğŸ‘„'
    ];

    _emojiCategories['People & Fantasy'] = [
      'ğŸ‘¶',
      'ğŸ§’',
      'ğŸ‘¦',
      'ğŸ‘§',
      'ğŸ§‘',
      'ğŸ‘±',
      'ğŸ‘¨',
      'ğŸ§”',
      'ğŸ‘¨â€ğŸ¦°',
      'ğŸ‘¨â€ğŸ¦±',
      'ğŸ‘¨â€ğŸ¦³',
      'ğŸ‘¨â€ğŸ¦²',
      'ğŸ‘©',
      'ğŸ‘©â€ğŸ¦°',
      'ğŸ‘©â€ğŸ¦±',
      'ğŸ‘©â€ğŸ¦³',
      'ğŸ‘©â€ğŸ¦²',
      'ğŸ§“',
      'ğŸ‘´',
      'ğŸ‘µ',
      'ğŸ™',
      'ğŸ™',
      'ğŸ™…',
      'ğŸ™†',
      'ğŸ’',
      'ğŸ™‹',
      'ğŸ§',
      'ğŸ™‡',
      'ğŸ¤¦',
      'ğŸ¤·',
      'ğŸ‘®',
      'ğŸ•µï¸',
      'ğŸ’‚',
      'ğŸ‘·',
      'ğŸ¤´',
      'ğŸ‘¸',
      'ğŸ‘³',
      'ğŸ‘²',
      'ğŸ§•',
      'ğŸ¤µ',
      'ğŸ‘°',
      'ğŸ¤°',
      'ğŸ¤±',
      'ğŸ‘¼',
      'ğŸ…',
      'ğŸ¤¶',
      'ğŸ¦¸',
      'ğŸ¦¹',
      'ğŸ§™',
      'ğŸ§š',
      'ğŸ§›',
      'ğŸ§œ',
      'ğŸ§',
      'ğŸ§',
      'ğŸ§Ÿ',
      'ğŸ’†',
      'ğŸ’‡',
      'ğŸš¶',
      'ğŸ§',
      'ğŸ§',
      'ğŸƒ',
      'ğŸ’ƒ',
      'ğŸ•º',
      'ğŸ•´ï¸',
      'ğŸ‘¯',
      'ğŸ§–',
      'ğŸ§—',
      'ğŸ¤º',
      'ğŸ‡',
      'â›·ï¸',
      'ğŸ‚',
      'ğŸŒï¸',
      'ğŸ„',
      'ğŸš£',
      'ğŸŠ',
      'â›¹ï¸',
      'ğŸ‹ï¸',
      'ğŸš´',
      'ğŸšµ',
      'ğŸ¤¸',
      'ğŸ¤¼',
      'ğŸ¤½',
      'ğŸ¤¾',
      'ğŸ¤¹',
      'ğŸ§˜',
      'ğŸ›€',
      'ğŸ›Œ',
      'ğŸ‘­',
      'ğŸ‘«',
      'ğŸ‘¬',
      'ğŸ’',
      'ğŸ’‘',
      'ğŸ‘ª'
    ];

    _emojiCategories['Nature & Animals'] = [
      'ğŸŒ',
      'ğŸŒ',
      'ğŸŒ',
      'ğŸŒ',
      'ğŸ—ºï¸',
      'ğŸ§­',
      'ğŸ”ï¸',
      'â›°ï¸',
      'ğŸŒ‹',
      'ğŸ—»',
      'ğŸ•ï¸',
      'ğŸ–ï¸',
      'ğŸœï¸',
      'ğŸï¸',
      'ğŸï¸',
      'ğŸŸï¸',
      'ğŸ›ï¸',
      'ğŸ—ï¸',
      'ğŸ§±',
      'ğŸ˜ï¸',
      'ğŸšï¸',
      'ğŸ ',
      'ğŸ¡',
      'ğŸ¢',
      'ğŸ£',
      'ğŸ¤',
      'ğŸ¥',
      'ğŸ¦',
      'ğŸ¨',
      'ğŸ©',
      'ğŸª',
      'ğŸ«',
      'ğŸ¬',
      'ğŸ­',
      'ğŸ¯',
      'ğŸ°',
      'ğŸ’’',
      'ğŸ—¼',
      'ğŸ—½',
      'â›ª',
      'ğŸ•Œ',
      'ğŸ›•',
      'ğŸ•',
      'â›©ï¸',
      'ğŸ•‹',
      'â›²',
      'â›º',
      'ğŸŒ',
      'ğŸŒƒ',
      'ğŸ™ï¸',
      'ğŸŒ„',
      'ğŸŒ…',
      'ğŸŒ†',
      'ğŸŒ‡',
      'ğŸŒ‰',
      'â™¨ï¸',
      'ğŸ ',
      'ğŸ¡',
      'ğŸ¢',
      'ğŸ’ˆ',
      'ğŸª'
    ];

    _emojiCategories['Food & Drink'] = [
      'ğŸ',
      'ğŸ',
      'ğŸ',
      'ğŸŠ',
      'ğŸ‹',
      'ğŸŒ',
      'ğŸ‰',
      'ğŸ‡',
      'ğŸ“',
      'ğŸ«',
      'ğŸˆ',
      'ğŸ’',
      'ğŸ‘',
      'ğŸ¥­',
      'ğŸ',
      'ğŸ¥¥',
      'ğŸ¥',
      'ğŸ…',
      'ğŸ†',
      'ğŸ¥‘',
      'ğŸ¥¦',
      'ğŸ¥¬',
      'ğŸ¥’',
      'ğŸŒ¶ï¸',
      'ğŸ«‘',
      'ğŸŒ½',
      'ğŸ¥•',
      'ğŸ«’',
      'ğŸ§„',
      'ğŸ§…',
      'ğŸ¥”',
      'ğŸ ',
      'ğŸ¥',
      'ğŸ¥¯',
      'ğŸ',
      'ğŸ¥–',
      'ğŸ¥¨',
      'ğŸ§€',
      'ğŸ¥š',
      'ğŸ³',
      'ğŸ§ˆ',
      'ğŸ¥',
      'ğŸ§‡',
      'ğŸ¥“',
      'ğŸ¥©',
      'ğŸ—',
      'ğŸ–',
      'ğŸ¦´',
      'ğŸŒ­',
      'ğŸ”',
      'ğŸŸ',
      'ğŸ•',
      'ğŸ«“',
      'ğŸ¥ª',
      'ğŸ¥™',
      'ğŸ§†',
      'ğŸŒ®',
      'ğŸŒ¯',
      'ğŸ«”',
      'ğŸ¥—',
      'ğŸ¥˜',
      'ğŸ«•',
      'ğŸ¥«',
      'ğŸ',
      'ğŸœ',
      'ğŸ²',
      'ğŸ›',
      'ğŸ£',
      'ğŸ±',
      'ğŸ¥Ÿ',
      'ğŸ¦ª',
      'ğŸ¤',
      'ğŸ™',
      'ğŸš',
      'ğŸ˜',
      'ğŸ¥',
      'ğŸ¥ ',
      'ğŸ¥®',
      'ğŸ¢',
      'ğŸ¡',
      'ğŸ§',
      'ğŸ¨',
      'ğŸ¦',
      'ğŸ¥§',
      'ğŸ§',
      'ğŸ°',
      'ğŸ‚',
      'ğŸ®',
      'ğŸ­',
      'ğŸ¬',
      'ğŸ«',
      'ğŸ¿',
      'ğŸ©',
      'ğŸª',
      'ğŸŒ°',
      'ğŸ¥œ',
      'ğŸ¯',
      'ğŸ¥›',
      'ğŸ¼',
      'ğŸ«–',
      'â˜•',
      'ğŸµ',
      'ğŸ§ƒ',
      'ğŸ¥¤',
      'ğŸ§‹',
      'ğŸ¶',
      'ğŸº',
      'ğŸ»',
      'ğŸ¥‚',
      'ğŸ·',
      'ğŸ¥ƒ',
      'ğŸ¸',
      'ğŸ¹',
      'ğŸ§‰',
      'ğŸ¾',
      'ğŸ§Š',
      'ğŸ¥„',
      'ğŸ´',
      'ğŸ½ï¸',
      'ğŸ¥£',
      'ğŸ¥¡',
      'ğŸ¥¢',
      'ğŸ§‚'
    ];

    _emojiCategories['Activities & Sports'] = [
      'âš½',
      'âš¾',
      'ğŸ¥',
      'ğŸ€',
      'ğŸ',
      'ğŸˆ',
      'ğŸ‰',
      'ğŸ¾',
      'ğŸ¥',
      'ğŸ³',
      'ğŸ',
      'ğŸ‘',
      'ğŸ’',
      'ğŸ¥',
      'ğŸ“',
      'ğŸ¸',
      'ğŸ¥Š',
      'ğŸ¥‹',
      'ğŸ¥…',
      'â›³',
      'â›¸ï¸',
      'ğŸ£',
      'ğŸ¤¿',
      'ğŸ½',
      'ğŸ¿',
      'ğŸ›·',
      'ğŸ¥Œ',
      'ğŸ¯',
      'ğŸª€',
      'ğŸª',
      'ğŸ”«',
      'ğŸ±',
      'ğŸ”®',
      'ğŸ®',
      'ğŸ•¹ï¸',
      'ğŸ°',
      'ğŸ²',
      'ğŸ§©',
      'â™ ï¸',
      'â™¥ï¸',
      'â™¦ï¸',
      'â™£ï¸',
      'ğŸƒ',
      'ğŸ€„',
      'ğŸ´',
      'ğŸ­',
      'ğŸ–¼ï¸',
      'ğŸ¨',
      'ğŸ§µ',
      'ğŸ§¶'
    ];

    _emojiCategories['Objects & Symbols'] = [
      'ğŸ‘“',
      'ğŸ•¶ï¸',
      'ğŸ¥½',
      'ğŸ¥¼',
      'ğŸ¦º',
      'ğŸ‘”',
      'ğŸ‘•',
      'ğŸ‘–',
      'ğŸ§£',
      'ğŸ§¤',
      'ğŸ§¥',
      'ğŸ§¦',
      'ğŸ‘—',
      'ğŸ‘˜',
      'ğŸ¥»',
      'ğŸ©±',
      'ğŸ©²',
      'ğŸ©³',
      'ğŸ‘™',
      'ğŸ‘š',
      'ğŸ‘›',
      'ğŸ‘œ',
      'ğŸ‘',
      'ğŸ’',
      'ğŸ‘',
      'ğŸ‘Ÿ',
      'ğŸ¥¾',
      'ğŸ¥¿',
      'ğŸ‘ ',
      'ğŸ‘¡',
      'ğŸ©°',
      'ğŸ‘¢',
      'ğŸ‘‘',
      'ğŸ‘’',
      'ğŸ©',
      'ğŸ“',
      'ğŸ§¢',
      'â›‘ï¸',
      'ğŸ’„',
      'ğŸ’',
      'ğŸ’¼',
      'ğŸŒ‚',
      'â˜‚ï¸',
      'ğŸ§³',
      'ğŸ“±',
      'ğŸ“²',
      'ğŸ’»',
      'âŒ¨ï¸',
      'ğŸ–¥ï¸',
      'ğŸ–¨ï¸',
      'ğŸ–±ï¸',
      'ğŸ–²ï¸',
      'ğŸ’½',
      'ğŸ’¾',
      'ğŸ’¿',
      'ğŸ“€',
      'ğŸ“¼',
      'ğŸ“·',
      'ğŸ“¸',
      'ğŸ“¹',
      'ğŸ¥',
      'ğŸ“½ï¸',
      'ğŸï¸',
      'ğŸ“',
      'â˜ï¸',
      'ğŸ“Ÿ',
      'ğŸ“ ',
      'ğŸ“º',
      'ğŸ“»',
      'ğŸ™ï¸',
      'ğŸšï¸',
      'ğŸ›ï¸',
      'ğŸ§­',
      'â±ï¸',
      'â²ï¸',
      'â°',
      'ğŸ•°ï¸',
      'âŒ›',
      'â³',
      'ğŸ“¡',
      'ğŸ”‹',
      'ğŸ”Œ',
      'ğŸ’¡',
      'ğŸ”¦',
      'ğŸ•¯ï¸',
      'ğŸª”',
      'ğŸ§¯',
      'ğŸ›¢ï¸',
      'ğŸ’¸',
      'ğŸ’µ',
      'ğŸ’´',
      'ğŸ’¶',
      'ğŸ’·',
      'ğŸ’°',
      'ğŸ’³',
      'ğŸ’',
      'âš–ï¸',
      'ğŸ¦¯',
      'ğŸ§°',
      'ğŸ”§',
      'ğŸ”¨',
      'âš’ï¸',
      'ğŸ› ï¸',
      'â›ï¸',
      'ğŸ”©',
      'âš™ï¸',
      'ğŸ§±',
      'â›“ï¸',
      'ğŸ§²',
      'ğŸ”«',
      'ğŸ’£',
      'ğŸ§¨',
      'ğŸª“',
      'ğŸ”ª',
      'ğŸ—¡ï¸',
      'âš”ï¸',
      'ğŸ›¡ï¸',
      'ğŸš¬',
      'âš°ï¸',
      'âš±ï¸',
      'ğŸº',
      'ğŸ”®',
      'ğŸ“¿',
      'ğŸ§¿',
      'ğŸ’ˆ',
      'âš—ï¸',
      'ğŸ”­',
      'ğŸ”¬',
      'ğŸ•³ï¸',
      'ğŸ©¹',
      'ğŸ©º',
      'ğŸ’Š',
      'ğŸ’‰',
      'ğŸ©¸',
      'ğŸ§¬',
      'ğŸ¦ ',
      'ğŸ§«',
      'ğŸ§ª',
      'ğŸŒ¡ï¸',
      'ğŸ§¹',
      'ğŸ§º',
      'ğŸ§»',
      'ğŸš½',
      'ğŸš°',
      'ğŸš¿',
      'ğŸ›',
      'ğŸ›€',
      'ğŸ§¼',
      'ğŸª’',
      'ğŸ§½',
      'ğŸ§´',
      'ğŸ›ï¸',
      'ğŸ”‘',
      'ğŸ—ï¸',
      'ğŸšª',
      'ğŸª‘',
      'ğŸ›‹ï¸',
      'ğŸ›ï¸',
      'ğŸ›Œ',
      'ğŸ§¸',
      'ğŸ–¼ï¸',
      'ğŸ›ï¸',
      'ğŸ›’',
      'ğŸ',
      'ğŸˆ',
      'ğŸ',
      'ğŸ€',
      'ğŸŠ',
      'ğŸ‰',
      'ğŸ',
      'ğŸ®',
      'ğŸ',
      'âœ‰ï¸',
      'ğŸ“©',
      'ğŸ“¨',
      'ğŸ“§',
      'ğŸ’Œ',
      'ğŸ“¥',
      'ğŸ“¤',
      'ğŸ“¦',
      'ğŸ·ï¸',
      'ğŸ“ª',
      'ğŸ“«',
      'ğŸ“¬',
      'ğŸ“­',
      'ğŸ“®',
      'ğŸ“¯',
      'ğŸ“œ',
      'ğŸ“ƒ',
      'ğŸ“„',
      'ğŸ“‘',
      'ğŸ§¾',
      'ğŸ“Š',
      'ğŸ“ˆ',
      'ğŸ“‰',
      'ğŸ—’ï¸',
      'ğŸ—“ï¸',
      'ğŸ“†',
      'ğŸ“…',
      'ğŸ—‘ï¸',
      'ğŸ“‡',
      'ğŸ—ƒï¸',
      'ğŸ—³ï¸',
      'ğŸ—„ï¸',
      'ğŸ“‹',
      'ğŸ“',
      'ğŸ“‚',
      'ğŸ—‚ï¸',
      'ğŸ—ï¸',
      'ğŸ“°',
      'ğŸ““',
      'ğŸ“”',
      'ğŸ“’',
      'ğŸ“•',
      'ğŸ“—',
      'ğŸ“˜',
      'ğŸ“™',
      'ğŸ“š',
      'ğŸ“–',
      'ğŸ”–',
      'ğŸ§·',
      'ğŸ”—',
      'ğŸ“',
      'ğŸ–‡ï¸',
      'ğŸ“',
      'ğŸ“',
      'ğŸ§®',
      'ğŸ“Œ',
      'ğŸ“',
      'âœ‚ï¸',
      'ğŸ–Šï¸',
      'ğŸ–‹ï¸',
      'âœ’ï¸',
      'ğŸ–Œï¸',
      'ğŸ–ï¸',
      'ğŸ“',
      'âœï¸',
      'ğŸ”',
      'ğŸ”',
      'ğŸ”',
      'ğŸ”',
      'ğŸ”’',
      'ğŸ”“'
    ];

    _emojiCategories['Travel & Transport'] = [
      'ğŸš‚',
      'ğŸšƒ',
      'ğŸš„',
      'ğŸš…',
      'ğŸš†',
      'ğŸš‡',
      'ğŸšˆ',
      'ğŸš‰',
      'ğŸšŠ',
      'ğŸš',
      'ğŸš',
      'ğŸš‹',
      'ğŸšŒ',
      'ğŸš',
      'ğŸš',
      'ğŸš',
      'ğŸš‘',
      'ğŸš’',
      'ğŸš“',
      'ğŸš”',
      'ğŸš•',
      'ğŸš–',
      'ğŸš—',
      'ğŸš˜',
      'ğŸš™',
      'ğŸšš',
      'ğŸš›',
      'ğŸšœ',
      'ğŸï¸',
      'ğŸï¸',
      'ğŸ›µ',
      'ğŸš²',
      'ğŸ›´',
      'ğŸ›¹',
      'ğŸš',
      'ğŸ›£ï¸',
      'ğŸ›¤ï¸',
      'â›½',
      'ğŸš¨',
      'ğŸš¥',
      'ğŸš¦',
      'ğŸ›‘',
      'ğŸš§',
      'âš“',
      'â›µ',
      'ğŸ›¶',
      'ğŸš¤',
      'ğŸ›³ï¸',
      'â›´ï¸',
      'ğŸ›¥ï¸',
      'ğŸš¢',
      'âœˆï¸',
      'ğŸ›©ï¸',
      'ğŸ›«',
      'ğŸ›¬',
      'ğŸª‚',
      'ğŸ’º',
      'ğŸš',
      'ğŸšŸ',
      'ğŸš ',
      'ğŸš¡',
      'ğŸ›°ï¸',
      'ğŸš€',
      'ğŸ›¸'
    ];

    _emojiCategories['Symbols & Signs'] = [
      'â¤ï¸',
      'ğŸ§¡',
      'ğŸ’›',
      'ğŸ’š',
      'ğŸ’™',
      'ğŸ’œ',
      'ğŸ–¤',
      'ğŸ¤',
      'ğŸ¤',
      'ğŸ’”',
      'â£ï¸',
      'ğŸ’•',
      'ğŸ’',
      'ğŸ’“',
      'ğŸ’—',
      'ğŸ’–',
      'ğŸ’˜',
      'ğŸ’',
      'ğŸ’Ÿ',
      'â˜®ï¸',
      'âœï¸',
      'â˜ªï¸',
      'ğŸ•‰ï¸',
      'â˜¸ï¸',
      'âœ¡ï¸',
      'ğŸ”¯',
      'ğŸ•',
      'â˜¯ï¸',
      'â˜¦ï¸',
      'ğŸ›',
      'â›',
      'â™ˆ',
      'â™‰',
      'â™Š',
      'â™‹',
      'â™Œ',
      'â™',
      'â™',
      'â™',
      'â™',
      'â™‘',
      'â™’',
      'â™“',
      'ğŸ†”',
      'âš›ï¸',
      'ğŸ‰‘',
      'â˜¢ï¸',
      'â˜£ï¸',
      'ğŸ“´',
      'ğŸ“³',
      'ğŸˆ¶',
      'ğŸˆš',
      'ğŸˆ¸',
      'ğŸˆº',
      'ğŸˆ·ï¸',
      'âœ´ï¸',
      'ğŸ†š',
      'ğŸ’®',
      'ğŸ‰',
      'ãŠ™ï¸',
      'ãŠ—ï¸',
      'ğŸˆ´',
      'ğŸˆµ',
      'ğŸˆ¹',
      'ğŸˆ²',
      'ğŸ…°ï¸',
      'ğŸ…±ï¸',
      'ğŸ†',
      'ğŸ†‘',
      'ğŸ…¾ï¸',
      'ğŸ†˜',
      'âŒ',
      'â­•',
      'ğŸ›‘',
      'â›”',
      'ğŸ“›',
      'ğŸš«',
      'ğŸ’¯',
      'ğŸ’¢',
      'â™¨ï¸',
      'ğŸš·',
      'ğŸš¯',
      'ğŸš³',
      'ğŸš±',
      'ğŸ”',
      'ğŸ“µ',
      'ğŸš­',
      'â—',
      'â•',
      'â“',
      'â”',
      'â€¼ï¸',
      'â‰ï¸',
      'ğŸ”…',
      'ğŸ”†',
      'ã€½ï¸',
      'âš ï¸',
      'ğŸš¸',
      'ğŸ”±',
      'âšœï¸',
      'ğŸ”°',
      'â™»ï¸',
      'âœ…',
      'ğŸˆ¯',
      'ğŸ’¹',
      'â‡ï¸',
      'âœ³ï¸',
      'â',
      'ğŸŒ',
      'ğŸ’ ',
      'â“‚ï¸',
      'ğŸŒ€',
      'ğŸ’¤',
      'ğŸ§',
      'ğŸš¾',
      'â™¿',
      'ğŸ…¿ï¸',
      'ğŸˆ³',
      'ğŸˆ‚ï¸',
      'ğŸ›‚',
      'ğŸ›ƒ',
      'ğŸ›„',
      'ğŸ›…',
      'ğŸš¹',
      'ğŸšº',
      'ğŸš¼',
      'ğŸš»',
      'ğŸš®',
      'ğŸ¦',
      'ğŸ“¶',
      'ğŸˆ',
      'ğŸ”£',
      'â„¹ï¸',
      'ğŸ”¤',
      'ğŸ”¡',
      'ğŸ” ',
      'ğŸ†–',
      'ğŸ†—',
      'ğŸ†™',
      'ğŸ†’',
      'ğŸ†•',
      'ğŸ†“',
      '0ï¸âƒ£',
      '1ï¸âƒ£',
      '2ï¸âƒ£',
      '3ï¸âƒ£',
      '4ï¸âƒ£',
      '5ï¸âƒ£',
      '6ï¸âƒ£',
      '7ï¸âƒ£',
      '8ï¸âƒ£',
      '9ï¸âƒ£',
      'ğŸ”Ÿ',
      'ğŸ”¢',
      '#ï¸âƒ£',
      '*ï¸âƒ£',
      'âï¸',
      'â–¶ï¸',
      'â¸ï¸',
      'â¯ï¸',
      'â¹ï¸',
      'âºï¸',
      'â­ï¸',
      'â®ï¸',
      'â©',
      'âª',
      'â«',
      'â¬',
      'â—€ï¸',
      'ğŸ”¼',
      'ğŸ”½',
      'â¡ï¸',
      'â¬…ï¸',
      'â¬†ï¸',
      'â¬‡ï¸',
      'â†—ï¸',
      'â†˜ï¸',
      'â†™ï¸',
      'â†–ï¸',
      'â†•ï¸',
      'â†”ï¸',
      'â†ªï¸',
      'â†©ï¸',
      'â¤´ï¸',
      'â¤µï¸',
      'ğŸ”€',
      'ğŸ”',
      'ğŸ”‚',
      'ğŸ”„',
      'ğŸ”ƒ',
      'ğŸµ',
      'ğŸ¶',
      'â•',
      'â–',
      'â—',
      'â™¾ï¸',
      'ğŸ’²',
      'ğŸ’±',
      'â„¢ï¸',
      'Â©ï¸',
      'Â®ï¸',
      'ã€°ï¸',
      'â°',
      'â¿',
      'ğŸ”š',
      'ğŸ”™',
      'ğŸ”›',
      'ğŸ”',
      'ğŸ”œ',
      'âœ”ï¸',
      'â˜‘ï¸',
      'ğŸ”˜',
      'ğŸ”´',
      'ğŸŸ ',
      'ğŸŸ¡',
      'ğŸŸ¢',
      'ğŸ”µ',
      'ğŸŸ£',
      'âš«',
      'âšª',
      'ğŸŸ¤',
      'ğŸ”º',
      'ğŸ”»',
      'ğŸ”¸',
      'ğŸ”¹',
      'ğŸ”¶',
      'ğŸ”·',
      'ğŸ”³',
      'ğŸ”²',
      'â–ªï¸',
      'â–«ï¸',
      'â—¾',
      'â—½',
      'â—¼ï¸',
      'â—»ï¸',
      'ğŸŸ¥',
      'ğŸŸ§',
      'ğŸŸ¨',
      'ğŸŸ©',
      'ğŸŸ¦',
      'ğŸŸª',
      'â¬›',
      'â¬œ',
      'ğŸŸ«',
      'ğŸ”ˆ',
      'ğŸ”‡',
      'ğŸ”‰',
      'ğŸ”Š',
      'ğŸ””',
      'ğŸ”•',
      'ğŸ“£',
      'ğŸ“¢',
      'ğŸ‘ï¸â€ğŸ—¨ï¸',
      'ğŸ’¬',
      'ğŸ’­',
      'ğŸ—¯ï¸'
    ];

    // Initialize category tabs
    _categoryTabs = ['All', ..._emojiCategories.keys.toList()];

    // Initialize search keywords
    _initializeKeywords();
  }

  void _initializeKeywords() {
    // Add search keywords for better search experience
    _emojiKeywords.addAll({
      'ğŸ˜€': 'grinning face happy smile',
      'ğŸ˜‚': 'tears of joy laughing funny',
      'â¤ï¸': 'heart love red',
      'ğŸš€': 'rocket space launch',
      'ğŸ‰': 'party celebration tada',
      'â­': 'star',
      'ğŸ”¥': 'fire hot lit',
      'ğŸ‘': 'thumbs up like good',
      'ğŸ‚': 'birthday cake',
      'ğŸ„': 'christmas tree',
      'ğŸ': 'gift present',
      'ğŸ“±': 'phone mobile smartphone',
      'ğŸ’»': 'laptop computer',
      'â˜•': 'coffee tea drink',
      'ğŸ•': 'pizza food italian',
      'ğŸ': 'apple fruit red',
      'ğŸ±': 'cat pet animal',
      'ğŸ¶': 'dog pet animal',
      'ğŸŒ': 'sun sunny weather',
      'ğŸŒ™': 'moon night',
      'ğŸŒˆ': 'rainbow colorful',
      'ğŸµ': 'music note sound',
      'âš½': 'soccer football sport',
      'ğŸ®': 'video game controller',
      'ğŸ’¡': 'light bulb idea',
      'ğŸ”‘': 'key lock security',
      'ğŸ’°': 'money cash rich',
      'ğŸ“': 'graduation cap student',
      'ğŸ†': 'trophy winner prize',
      'ğŸš—': 'car vehicle auto',
      'âœˆï¸': 'airplane travel flight',
      'ğŸ ': 'house home building',
      'ğŸŒº': 'flower blossom nature',
      'ğŸ“š': 'books study library',
      'â°': 'alarm clock time',
      'ğŸ”': 'magnifying glass search',
      'ğŸ¨': 'art paint palette',
      'ğŸ€': 'basketball sport game',
      'ğŸ¸': 'guitar music instrument',
      'ğŸº': 'beer drink alcohol',
      'ğŸŒ®': 'taco food mexican',
      'ğŸ‘‘': 'crown king queen royal',
      'âš¡': 'lightning bolt fast electric',
      'ğŸ¯': 'dart target bullseye',
      'ğŸ”’': 'lock security private',
      'ğŸ’': 'diamond gem jewel',
      'ğŸï¸': 'island beach tropical',
      'ğŸŠ': 'confetti party celebration',
      'ğŸ‘‹': 'wave hello goodbye',
      'ğŸ™': 'pray thank you please',
      'ğŸ˜': 'heart eyes love adore',
      'ğŸ¥°': 'smiling hearts love',
      'ğŸ¤”': 'thinking thought question',
      'ğŸ˜´': 'sleep tired sleepy',
      'ğŸ¥³': 'partying face celebrate',
      'ğŸ˜': 'cool sunglasses awesome',
      'ğŸ¤¯': 'exploding head mind blown',
      'ğŸ¥º': 'pleading face puppy eyes',
      'ğŸ˜­': 'crying sad sobbing',
      'ğŸ˜¡': 'angry mad furious',
      'ğŸ¤¢': 'nauseated sick disgusted',
      'ğŸ¤®': 'vomiting sick puke',
      'ğŸ¤§': 'sneezing sick allergy',
      'ğŸ˜·': 'mask doctor sick',
      'ğŸ¤ ': 'cowboy hat western',
      'ğŸ‘»': 'ghost scary boo',
      'ğŸ’€': 'skull death dead',
      'ğŸ‘‘': 'crown king queen',
      'ğŸ…': 'santa christmas',
      'ğŸ¤¶': 'mrs claus christmas',
      'ğŸ¦¸': 'superhero hero',
      'ğŸ§™': 'wizard magic',
      'ğŸ§š': 'fairy magical',
      'ğŸ¹': 'piano keyboard music',
      'ğŸ¥': 'drum music instrument',
      'ğŸ¤': 'microphone sing music',
      'ğŸ§': 'headphones music listen',
      'ğŸ¬': 'clapperboard movie film',
      'ğŸˆ': 'football american sport',
      'âš¾': 'baseball sport game',
      'ğŸ¾': 'tennis sport racket',
      'ğŸ': 'volleyball sport',
      'ğŸ±': 'pool billiards 8ball',
      'ğŸ¥Š': 'boxing glove fight',
      'ğŸ›¹': 'skateboard skate',
      'ğŸ›´': 'scooter kick',
      'ğŸš²': 'bicycle bike cycling',
      'ğŸï¸': 'motorcycle bike',
      'ğŸ›¸': 'ufo alien spaceship',
      'ğŸ’º': 'seat chair',
      'ğŸš': 'helicopter fly',
      'ğŸ›¶': 'canoe boat paddle',
      'â›µ': 'sailboat sailing',
      'ğŸš¤': 'speedboat fast boat',
      'ğŸ›³ï¸': 'passenger ship cruise',
      'ğŸš¢': 'ship boat sea',
      'ğŸ°': 'castle europe palace',
      'ğŸ—¼': 'tokyo tower eiffel',
      'ğŸ—½': 'statue liberty new york',
      'â›ª': 'church religion',
      'ğŸ•Œ': 'mosque islam',
      'ğŸ•': 'synagogue jewish',
      'â›©ï¸': 'shinto shrine japan',
      'ğŸ¡': 'ferris wheel amusement',
      'ğŸ¢': 'roller coaster thrill',
      'ğŸ ': 'carousel horse merry',
      'ğŸŸï¸': 'stadium sports arena',
      'ğŸ­': 'theater drama mask',
      'ğŸ§µ': 'thread sewing needle',
      'ğŸ§¶': 'yarn knitting wool',
      'ğŸª': 'circus tent big top',
      'ğŸ²': 'dice game random',
      'ğŸ§©': 'puzzle piece jigsaw',
      'ğŸª€': 'yo-yo toy play',
      'ğŸª': 'kite fly wind',
      'ğŸ”«': 'water gun pistol toy',
      'ğŸ•¹ï¸': 'joystick arcade game',
      'ğŸ°': 'slot machine gambling',
      'ğŸ³': 'bowling ball pins',
    });
  }

  List<String> _getAllEmojis() {
    return _emojiCategories.values.expand((list) => list).toList();
  }

  List<String> _getEmojisForCategory(String category) {
    if (category == 'All') {
      return _getAllEmojis();
    }
    return _emojiCategories[category] ?? [];
  }

  void _filterEmojis() {
    final query = _searchController.text.toLowerCase().trim();

    if (query.isEmpty) {
      setState(() {
        _filteredEmojis = _getEmojisForCategory(_selectedCategory);
      });
    } else {
      final categoryEmojis = _getEmojisForCategory(_selectedCategory);
      setState(() {
        _filteredEmojis = categoryEmojis.where((emoji) {
          // Search in emoji character
          if (emoji.toLowerCase().contains(query)) return true;

          // Search in keywords
          final keywords = _emojiKeywords[emoji] ?? '';
          return keywords.toLowerCase().contains(query);
        }).toList();
      });
    }
  }

  void _selectCategory(String category) {
    setState(() {
      _selectedCategory = category;
      _filteredEmojis = _getEmojisForCategory(category);
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Select Emoji'),
        backgroundColor: Colors.transparent,
        elevation: 0,
        leading: IconButton(
          icon: const Icon(Icons.arrow_back),
          onPressed: () => Navigator.pop(context),
        ),
      ),
      body: Column(
        children: [
          // Search Bar
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: TextField(
              controller: _searchController,
              decoration: InputDecoration(
                hintText: 'Search emojis...',
                prefixIcon: const Icon(Icons.search),
                border: OutlineInputBorder(
                  borderRadius: BorderRadius.circular(12),
                ),
                filled: true,
                fillColor: Theme.of(context).cardColor,
              ),
            ),
          ),

          // Category Tabs
          SizedBox(
            height: 50,
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : ListView.builder(
                    scrollDirection: Axis.horizontal,
                    itemCount: _categoryTabs.length,
                    itemBuilder: (context, index) {
                      final category = _categoryTabs[index];
                      final isSelected = _selectedCategory == category;

                      return Padding(
                        padding: const EdgeInsets.symmetric(horizontal: 4),
                        child: FilterChip(
                          label: Text(category),
                          selected: isSelected,
                          onSelected: (selected) => _selectCategory(category),
                          backgroundColor: Colors.transparent,
                          selectedColor:
                              Theme.of(context).primaryColor.withOpacity(0.2),
                          checkmarkColor: Theme.of(context).primaryColor,
                          labelStyle: TextStyle(
                            color: isSelected
                                ? Theme.of(context).primaryColor
                                : Theme.of(context).textTheme.bodyLarge?.color,
                          ),
                          shape: StadiumBorder(
                            side: BorderSide(
                              color: isSelected
                                  ? Theme.of(context).primaryColor
                                  : Colors.grey[300]!,
                            ),
                          ),
                        ),
                      );
                    },
                  ),
          ),

          const SizedBox(height: 8),

          // Emoji Grid
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _filteredEmojis.isEmpty
                    ? const Center(
                        child: Column(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            Icon(Icons.emoji_emotions_outlined,
                                size: 64, color: Colors.grey),
                            SizedBox(height: 16),
                            Text(
                              'No emojis found',
                              style:
                                  TextStyle(fontSize: 16, color: Colors.grey),
                            ),
                          ],
                        ),
                      )
                    : GridView.builder(
                        padding: const EdgeInsets.all(16),
                        gridDelegate:
                            const SliverGridDelegateWithFixedCrossAxisCount(
                          crossAxisCount: 8,
                          crossAxisSpacing: 8,
                          mainAxisSpacing: 8,
                        ),
                        itemCount: _filteredEmojis.length,
                        itemBuilder: (context, index) {
                          final emoji = _filteredEmojis[index];
                          final isSelected = widget.currentEmoji == emoji;

                          return GestureDetector(
                            onTap: () {
                              widget.onEmojiSelected(emoji);
                              Navigator.pop(context);
                            },
                            child: Container(
                              decoration: BoxDecoration(
                                color: isSelected
                                    ? Theme.of(context)
                                        .primaryColor
                                        .withOpacity(0.2)
                                    : Colors.transparent,
                                borderRadius: BorderRadius.circular(8),
                                border: isSelected
                                    ? Border.all(
                                        color: Theme.of(context).primaryColor,
                                        width: 2,
                                      )
                                    : null,
                              ),
                              child: Center(
                                child: Text(
                                  emoji,
                                  style: const TextStyle(fontSize: 24),
                                ),
                              ),
                            ),
                          );
                        },
                      ),
          ),
        ],
      ),
    );
  }
}
